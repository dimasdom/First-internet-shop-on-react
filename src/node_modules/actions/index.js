import {FetchPhonesAPI} from 'api/index'
import {fetchPhoneByIDAPI, loadMorePhonesAPI,fetchCategoriesAPI} from "api";
import {
    AddPhoneToBasketAC, ClearBasketAC, FetchCategoriesAC,
    FetchPhoneAC, FetchPhoneByIDAC, FetchPhoneByIDFlAC, FetchPhoneByIDScAC,
    FetchPhoneFlAC,
    FetchPhoneScAC,
    LoadMorePhoneAC,
    LoadMorePhoneFlAC,
    LoadMorePhoneScAC, RemovePhoneAC, SeatchPhoneAC
} from "actions/actionCreators";




//async func which push phone in state
export let FetchPhones = () => async (dispatch) => {
    dispatch(FetchPhoneAC)
    try {
        let phones = await FetchPhonesAPI();
        dispatch(FetchPhoneScAC(phones))
    } catch (err) {
        dispatch(FetchPhoneFlAC(err))
    }
}
//push more phones in state
export let loadMorePhones = () => async (dispatch,getState) => {
    //start of push new phones
    dispatch(LoadMorePhoneAC);
    try {
        //if we get phones from API
        let phones = await loadMorePhonesAPI();
        dispatch(LoadMorePhoneScAC(phones))
    } catch (err) {
        //catching the error from API
        dispatch(LoadMorePhoneFlAC(err))
    }
}

//take phone by id
export let fetchPhoneByID =(id)=> async (dispatch) => {
    //start to fetch phone by id
    dispatch(FetchPhoneByIDAC)
    try {
        //taking the phone from API
        const phone = await fetchPhoneByIDAPI(id)
        //push phone if we take phones
        dispatch(FetchPhoneByIDScAC(phone))
    }catch (err) {
        //catch error
        dispatch(FetchPhoneByIDFlAC(err))
    }
}

export let addPhoneToBasket = id => dispatch =>{
    //add phone to basket
    dispatch(AddPhoneToBasketAC(id))
}
export let searchPhone = text => dispatch =>{
    //add phone to basket
    dispatch(SeatchPhoneAC(text))
}

export let fetchCategories = () => async (dispatch)=>{
    const categories = await fetchCategoriesAPI()
    dispatch(FetchCategoriesAC(categories))
}

export let removePhoneFromBasket = id => dispatch => {
    dispatch(RemovePhoneAC(id))
}

export let cleanBasket = () => dispatch =>{
    dispatch(ClearBasketAC)
}

export let basketCheckout = phone => () =>{
    alert(JSON.stringify(phone))
}