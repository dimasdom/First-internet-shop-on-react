import {FetchPhonesAPI} from 'api/index'
import {getRenderedPhonesLength} from "selectors";
import {fetchPhoneByIDAPI, loadMorePhonesAPI} from "api";
export  const FETCH_PHONE_LOADING = "FETCH_PHONE_LOADING";
export const FETCH_PHONE_SUCCESS = "FETCH_PHONE_SUCCES";
export const FETCH_PHONE_FAILURE = "FETCH_PHONE_FAIL";
export  const LOAD_MORE_PHONE_LOADING = "LOAD_MORE_PHONE_LOADING";
export const LOAD_MORE_PHONE_SUCCESS = "LOAD_MORE_PHONE_SUCCES";
export const LOAD_MORE_PHONE_FAILURE = "LOAD_MORE_PHONE_FAIL";
export  const FETCH_PHONE_BY_ID_LOADING = "FETCH_PHONE_BY_ID_LOADING";
export const FETCH_PHONE_BY_ID_SUCCESS = "FETCH_PHONE_BY_ID_SUCCES";
export const FETCH_PHONE_BY_ID_FAILURE = "FETCH_PHONE_BY_ID_FAIL";

const FetchPhoneAC = {type:FETCH_PHONE_LOADING};
const FetchPhoneScAC =(phones) => ({type:FETCH_PHONE_SUCCESS , payload:phones});
const FetchPhoneFlAC =(err)=> ({type:FETCH_PHONE_FAILURE , payload:err , error:true});
const LoadMorePhoneAC = {type:LOAD_MORE_PHONE_LOADING};
const LoadMorePhoneScAC =(phones) => ({type:LOAD_MORE_PHONE_SUCCESS , payload:phones});
const LoadMorePhoneFlAC =(err)=> ({type:LOAD_MORE_PHONE_FAILURE , payload:err , error:true});
const FetchPhoneByIDAC = {type:FETCH_PHONE_BY_ID_LOADING};
const FetchPhoneByIDScAC =(phone) => ({type:FETCH_PHONE_BY_ID_SUCCESS , payload:phone});
const FetchPhoneByIDFlAC =(err)=> ({type:FETCH_PHONE_BY_ID_FAILURE , payload:err , error:true});

export let FetchPhones = () => async (dispatch) => {
    dispatch(FetchPhoneAC)
    try {
        let phones = await FetchPhonesAPI();
        dispatch(FetchPhoneScAC(phones))
    } catch (err) {
        dispatch(FetchPhoneFlAC(err))
    }
}

export let loadMorePhones = () => async (dispatch,getState) => {
    console.log("hey")
    const offset = getRenderedPhonesLength(getState())
    dispatch(LoadMorePhoneAC)
    try {
        let phones = await loadMorePhonesAPI(offset);
        dispatch(LoadMorePhoneScAC(phones))
    } catch (err) {
        dispatch(LoadMorePhoneFlAC(err))
    }
}


export let fetchPhoneByID =(id)=> async (dispatch) => {
    dispatch(FetchPhoneByIDAC)
    try {
        const phone = await fetchPhoneByIDAPI(id)
        dispatch(FetchPhoneByIDScAC(phone))
    }catch (err) {
        dispatch(FetchPhoneByIDFlAC(err))
    }
}