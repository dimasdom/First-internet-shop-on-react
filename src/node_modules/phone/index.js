import React , {useEffect} from 'react'
import {connect} from "react-redux";
import {addPhoneToBasket, fetchPhoneByID} from "actions";
import * as R from 'ramda'
import BasketCart from "components/BasketCart";
import {Link} from "react-router-dom";
import {getPhoneById} from "selectors";
let Phone = (props)=>{
    //take data from state async
    useEffect(()=> {props.fetchPhoneByID(props.match.params.id)})

   //Function which return component with Phone specs
    let renderFields = () => {
        //distructure props to phone
        let {phone} = props;
        //create 2 dimention array to return phone specs
        const columnField = R.compose(
         R.toPairs,R.pick(['cpu', 'camera', 'size', 'weight', 'display', 'battery', 'memory'])
        )(phone)
        return columnField.map(([key,value])=>(
            <div className='column' key={key}>
                <div className='ab-details-title'>
                    <p>{key}</p>
                </div>
                <div className='ab-details-info'>
                    {value}
                </div>
            </div>
        ))
    }

    //func which return phone
    let renderContent = () =>{
        const {phone} = props
        return <div className='thumbnail'>
            <div className='row'>
                <div className='col-md-6'>
                    <img className='img-thumbnail' src={phone.image} alt={phone.name}/>
                </div>
                <div className='col-md-6'>
                    {renderFields()}
                </div>
            </div>
            <div className='caption-full'>
                <h4 className='pull-right'>${phone.price}</h4>
                <h4>{phone.name}</h4>
                <p>{phone.description}</p>
            </div>
        </div>
    }

    let renderSidebar = ()=>{
        //sidebar = basket cart
        const {phone,addPhoneToBasket} = props
        return <div>
            <p className='lead'>Quik shop</p>
            <BasketCart/>
            <div className='form-group'>
                <h1>{phone.name}</h1>
                <h1>${phone.price}</h1>
            </div>
            <Link to='/' className='btn btn-info btn-block'>Back To Store</Link>
            <button type="button"
            className="btn btn-success btn-block"
            onClick={()=> addPhoneToBasket(phone.id)}>Add to cart</button>
        </div>
    }
    const {phone} = props
    //phone page , will be showed when take data from api
    return <div className='viev-container'>
        <div className='container'>
            <div className='row'>
                <div className='col-md-9'>
                    { phone && renderContent()}
                </div>
                <div className='col-md-3'>{ phone && renderSidebar()}</div>
            </div>
        </div>
    </div>;
}
//state to props
let mapStateToProps = state => {
    return {
        phone : getPhoneById(state,state.phonePage.id)
    }
}
//actions to props
let mapDispatchToProps = {
    fetchPhoneByID,
    addPhoneToBasket
}
export default connect(mapStateToProps,mapDispatchToProps)(Phone)